service: pick-to-door-dev
frameworkVersion: "3"

provider:
  name: aws
  runtime: nodejs18.x
  region: "ap-south-1"
  iamRoleStatements:
    - Effect: "Allow"
      Action:
        - "logs:CreateLogGroup"
        - "logs:DescribeLogGroups"
        - "logs:CreateLogStream"
        - "logs:PutLogEvents"
      Resource: "*"

functions:
  function1:
    handler: index.handler

  getCustomer:
    handler: index.getCustomer

resources:
  Resources:
    Pick2DoorAppSyncAPI:
      Type: "AWS::AppSync::GraphQLApi"
      Properties:
        Name: "Pick2DoorAppSyncAPI"
        AuthenticationType: "API_KEY"

    Pick2DoorGraphApiSchema:
      Type: "AWS::AppSync::GraphQLSchema"
      Properties:
        ApiId:
          Fn::GetAtt:
            - "Pick2DoorAppSyncAPI"
            - "ApiId"
        Definition:
          Fn::Sub: "${file(schema.graphql)}"

    GetCustomerDataSource:
      Type: "AWS::AppSync::DataSource"
      Properties:
        Name: "GetCustomerDataSource"
        Type: "AWS_LAMBDA"
        ApiId:
          Fn::GetAtt:
            - "Pick2DoorAppSyncAPI"
            - "ApiId"
        LambdaConfig:
          LambdaFunctionArn:
            Fn::GetAtt:
              - GetCustomerLambdaFunction
              - Arn

    GetCustomerQueryResolver:
      Type: "AWS::AppSync::Resolver"
      Properties:
        ApiId:
          Fn::GetAtt:
            - "Pick2DoorAppSyncAPI"
            - "ApiId"
        TypeName: "Query"
        FieldName: "getCustomer"
        DataSourceName:
          Fn::GetAtt:
            - "GetCustomerDataSource"
            - "Name"
